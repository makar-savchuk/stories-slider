/**
 * UI Initiative Stories Slider 1.0.0
 *
 * Instagram-like Stories Slider Made With Swiper
 *
 * https://uiinitiative.com
 *
 * Copyright 2022-2023 UI Initiative
 *
 * Released under the UI Initiative Regular License
 *
 * Released on: July 3, 2023
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).createStoriesSlider=t()}(this,(function(){"use strict";return function(e,t={}){const i=e.querySelector(".swiper"),{autoplayDuration:s=5e3,Swiper:r,EffectCube:n,onSlidesIndexesChange:o,onAutoplayStart:a,onAutoplayStop:l}=t;let d,c,{enabled:u=!0}=t,p=0;const m=[];let f,v,h,y,b,E,S,g;const A=(e,t)=>{const i=m.indexOf(e);let r=void 0===t?s:t,n=parseInt(e.slides[e.activeIndex].getAttribute("data-duration"),10);const o=e.slides[e.activeIndex].querySelector("video");return Number.isNaN(n)&&o&&(n=1e3*o.duration),!Number.isNaN(n)&&n>0&&void 0===t&&(r=n),S=r,e.storiesSliderAutoplayTimeout=setTimeout((()=>{if(e.isEnd){if(p!==i)return;d.isEnd||d.slideNext()}else e.slideNext()}),r),a&&a(e),r},q=e=>{clearTimeout(e.storiesSliderAutoplayTimeout),l&&l(e)},T=e=>{q(e);const t=e.slides[e.activeIndex].querySelector("video");t&&(cancelAnimationFrame(c),t.pause());const i=S||s;let r=parseInt(e.slides[e.activeIndex].getAttribute("data-duration"),10);if(Number.isNaN(r)&&(r=void 0),!r&&t&&(r=1e3*t.duration),S=i-((new Date).getTime()-E),e.isEnd&&S<0)return;S<0&&(S=0);const n=1-S/(r||s),o=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`);o.querySelector("span").remove(),o.insertAdjacentHTML("beforeend",`<span style="transform:translateX(${100*n-100}%)"></span>`)},x=e=>{q(e),A(e),E=(new Date).getTime();const t=e.el.querySelector(".stories-slider-pagination-bullet-current");t&&t.classList.remove("stories-slider-pagination-bullet-current");const i=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`),s=e.slides[e.activeIndex].querySelector("video");if(s){s.currentTime=0;try{c=requestAnimationFrame((()=>{s.play()}))}catch(e){}}e.slides.forEach((e=>{e.querySelectorAll("video").forEach((e=>{e!==s&&(e.currentTime=0,s||cancelAnimationFrame(c),e.pause())}))})),m.filter(((e,t)=>t!==p)).forEach((e=>{e.el.querySelectorAll("video").forEach((e=>{s||cancelAnimationFrame(c),e.pause()}))}));const r=[...i.parentElement.children],n=[...r].filter(((e,t)=>t<r.indexOf(i))),a=[...r].filter(((e,t)=>t>r.indexOf(i)));n.forEach((e=>{e.classList.add("stories-slider-pagination-bullet-viewed"),e.querySelectorAll("span").forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend","<span></span>")})),a.forEach((e=>{e.classList.remove("stories-slider-pagination-bullet-viewed","stories-slider-pagination-bullet-current"),e.querySelectorAll("span").forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend","<span></span>")})),i.classList.remove("stories-slider-pagination-bullet-viewed"),i.classList.add("stories-slider-pagination-bullet-current"),[...i.children].forEach((e=>e.remove())),i.insertAdjacentHTML("beforeend","<span></span>"),i.clientWidth,i.querySelector("span").style.transform="translateX(0%)",i.querySelector("span").style.transitionDuration=`${S}ms`,o&&(cancelAnimationFrame(f),f=requestAnimationFrame((()=>{o(p,e.activeIndex)})))};return(()=>{const t=()=>{e.classList.add("stories-slider-perspective")},s=()=>{e.classList.remove("stories-slider-perspective")};d=new r(i,{modules:void 0!==n?[n]:[],effect:"cube",speed:500,threshold:5,cubeEffect:{shadow:!1},observer:!0,on:{transitionStart(){s()},sliderFirstMove(){s()},transitionEnd(){t()},init(e){e.params.resistanceRatio=.5,t()},slideChange(){const e=m[p];p=d.activeIndex;const t=m[p];q(e),A(t),x(t)}}})})(),e.querySelectorAll(".swiper .swiper").forEach(((e,t)=>{const i=new r(e,{speed:1,nested:!0,allowTouchMove:!1,observer:!0,on:{touchStart(e){v=!0,g=!1,h=(new Date).getTime(),y=setTimeout((()=>{g=!0,T(e)}),200)},touchEnd(e){clearTimeout(y),p===t&&v&&(b=(new Date).getTime()-h,g&&(e=>{if(e.isEnd&&S<0)return;E=(new Date).getTime(),A(e,S);const t=e.slides[e.activeIndex].querySelector("video");if(t)try{c=requestAnimationFrame((()=>{t.play()}))}catch(e){}const i=e.el.querySelector(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1}) > span`);i.style.transform="translateX(0%)",i.style.transitionDuration=`${S}ms`})(e),g=!1,v=!1)},init(e){u&&(p!==t?q(e):requestAnimationFrame((()=>{x(e)})))},slideChange(e){x(e)}}});(e=>{const t=e.querySelectorAll(".swiper-slide"),i=document.createElement("div");i.classList.add("stories-slider-pagination");for(let e=0;e<t.length;e+=1){const e=document.createElement("div");e.classList.add("stories-slider-pagination-bullet"),e.appendChild(document.createElement("span")),i.appendChild(e)}e.appendChild(i)})(e),((e,t)=>{e.querySelectorAll(".swiper-slide").forEach((e=>{const i=document.createElement("div"),s=document.createElement("div");i.classList.add("stories-slider-button","stories-slider-button-prev"),s.classList.add("stories-slider-button","stories-slider-button-next"),e.appendChild(i),e.appendChild(s),i.addEventListener("click",(()=>{b>200||(t.isBeginning?d.slidePrev():t.slidePrev())})),s.addEventListener("click",(()=>{b>200||(t.isEnd?d.slideNext():t.slideNext())}))}))})(e,i),m.push(i)})),{el:e,mainSwiper:d,subSwipers:m,destroy:()=>{d&&d.destroy&&d.destroy(),m.forEach((e=>{q(e),e.el.querySelectorAll(".stories-slider-pagination, .stories-slider-pagination-bullet").forEach((e=>e.remove())),(e=>{e.el.querySelectorAll(".stories-slider-button").forEach((e=>e.remove()))})(e),e.destroy&&e.destroy()}))},slideTo:(e,t)=>{if(d&&d.slideTo&&!d.destroyed&&d.slideTo(e,0),void 0!==t){const i=m[e];i.slideTo&&!i.destroyed&&(i.activeIndex===t?x(i):i.slideTo(t,0))}},enable:()=>{u||m.forEach(((e,t)=>{t===p&&x(e)}))},disable:()=>{u=!1,m.forEach(((e,t)=>{e.el.querySelectorAll("video").forEach((e=>{cancelAnimationFrame(c),e.pause()})),t===p?T(e):q(e)}))}}}}));
//# sourceMappingURL=stories-slider.min.js.map